import React, { useState, FC, ReactNode } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { ChevronDown, ChevronsRight } from 'lucide-react';

// --- TIPOS DE DADOS ATUALIZADOS ---
interface SubDetailCategory {
  category: string;
  items: string[];
}

interface RegimentoItem {
  id: string;
  title: string;
  content?: string;
  details?: string[];
  subDetails?: { title: string; items: string[] }[];
  categorizedDetails?: SubDetailCategory[]; // Novo campo para subfiltros
}

// --- DADOS DO REGIMENTO (MAIS DETALHADOS) ---
const regimentoData: RegimentoItem[] = [
    {
        id: 'cap1',
        title: 'Cap√≠tulo I - Constitui√ß√£o',
        content: '<strong>Art. 1¬∫</strong> ‚Äì Estabelece as normas do CMSP, com base na Lei Municipal n¬∫ 2.914-A/1997 e na Lei n¬∫ 4.341/2007, al√©m das Leis Federais 8.080/90 e 8.142/90.',
    },
    {
        id: 'cap2',
        title: 'Cap√≠tulo II - Defini√ß√£o e Objetivos',
        content: '<strong>Art. 2¬∫</strong> ‚Äì Define o CMSP como √≥rg√£o colegiado parit√°rio e permanente. Suas fun√ß√µes s√£o: consultiva, normativa, deliberativa, fiscalizadora e mobilizadora para o controle da pol√≠tica de sa√∫de.',
    },
    {
        id: 'cap3',
        title: 'Cap√≠tulo III - Diretrizes B√°sicas',
        content: '<strong>Art. 3¬∫</strong> ‚Äì Diretrizes priorit√°rias para a atua√ß√£o do conselho:',
        details: [
            'Garantir acesso universal e igualit√°rio √† sa√∫de.',
            'Integrar, hierarquizar e regionalizar os servi√ßos de sa√∫de.',
            'Promover a descentraliza√ß√£o efetiva das a√ß√µes.',
            'Garantir a participa√ß√£o popular e a democratiza√ß√£o das decis√µes.',
            'Efetivar uma pol√≠tica de Recursos Humanos com concurso, PCCR e educa√ß√£o permanente.',
        ],
    },
    {
        id: 'cap4',
        title: 'Cap√≠tulo IV - Compet√™ncias',
        content: '<strong>Art. 4¬∫</strong> ‚Äì O CMSP possui um vasto conjunto de compet√™ncias para o controle da pol√≠tica de sa√∫de. Explore as categorias abaixo para ver os detalhes:',
        categorizedDetails: [
            {
                category: 'Planejamento e Gest√£o Estrat√©gica',
                items: [
                    'Estabelecer, fiscalizar e avaliar a pol√≠tica de sa√∫de municipal.',
                    'Definir diretrizes para o Plano Municipal de Sa√∫de (PMS), PPA, e PAS.',
                    'Aprovar o Relat√≥rio Anual de Gest√£o (RAG).',
                    'Propor medidas para o aperfei√ßoamento do SUS municipal.',
                ],
            },
            {
                category: 'Fiscaliza√ß√£o Financeira e Or√ßament√°ria',
                items: [
                    'Acompanhar a execu√ß√£o e destina√ß√£o de recursos do Fundo Municipal de Sa√∫de (FMS).',
                    'Aprovar previamente propostas or√ßament√°rias do FMS.',
                    'Ter acesso integral a informa√ß√µes financeiras, contratos e conv√™nios do SUS municipal.',
                ],
            },
            {
                category: 'Controle Social e Participa√ß√£o Popular',
                items: [
                    'Garantir a participa√ß√£o da sociedade civil organizada.',
                    'Analisar e responder a propostas e den√∫ncias da popula√ß√£o.',
                    'Convocar e estruturar a Confer√™ncia Municipal de Sa√∫de.',
                    'Realizar audi√™ncias p√∫blicas para debater temas de sa√∫de.',
                ],
            },
             {
                category: 'Servi√ßos de Sa√∫de e Recursos Humanos',
                items: [
                    'Definir crit√©rios para localiza√ß√£o e tipo de unidades de sa√∫de.',
                    'Acompanhar e avaliar os servi√ßos prestados por entidades p√∫blicas e privadas conveniadas.',
                    'Fiscalizar a implanta√ß√£o de cursos na √°rea de sa√∫de.',
                    'Propor pol√≠ticas para a melhoria da forma√ß√£o dos trabalhadores da √°rea.',
                ],
            },
        ],
    },
    {
        id: 'cap5',
        title: 'Cap√≠tulo V - Composi√ß√£o',
        content: '<strong>Art. 5¬∫</strong> ‚Äì O CMSP √© composto por 16 membros titulares e seus suplentes, com a seguinte paridade:',
        details: [
            '<strong>50% ‚Äì Usu√°rios do SUS.</strong>',
            '25% ‚Äì Trabalhadores da sa√∫de.',
            '25% ‚Äì Representantes do governo e prestadores de servi√ßos.',
        ],
        subDetails: [
            {
                title: 'Regras Importantes:',
                items: [
                    '<strong>Indica√ß√£o:</strong> Os membros s√£o indicados de forma aut√¥noma por suas entidades e homologados pelo Prefeito.',
                    '<strong>Mandato:</strong> 2 anos, podendo ser prorrogado.',
                    '<strong>Perda de Mandato:</strong> Ocorre por faltas (3 seguidas ou 4 alternadas) ou se a conduta do membro for declarada incompat√≠vel com a fun√ß√£o.',
                    '<strong>Voto:</strong> Cada membro tem direito a um voto, sem voto de qualidade do presidente.',
                ],
            },
        ],
    },
    {
        id: 'cap6',
        title: 'Cap√≠tulo VI - Organiza√ß√£o',
        content: '<strong>Art. 6¬∫ a 48</strong> ‚Äì A estrutura do CMSP √© desenhada para garantir a operacionalidade e a representatividade. Conhe√ßa cada inst√¢ncia:',
        categorizedDetails: [
            {
                category: 'Plen√°rio: O Cora√ß√£o do Conselho',
                items: [
                    '√â o f√≥rum m√°ximo de delibera√ß√µes, com reuni√µes ordin√°rias e extraordin√°rias.',
                    'Compet√™ncia dos conselheiros: participar, discutir, votar, requerer informa√ß√µes e representar o conselho.',
                ],
            },
            {
                category: 'Mesa Diretora: A Lideran√ßa Executiva',
                items: [
                    'Composta por Presidente, Vice-Presidente e Secret√°rios, com mandato de 2 anos.',
                    'Respons√°vel por articular o funcionamento, preparar pautas e encaminhar as delibera√ß√µes do Plen√°rio.',
                ],
            },
            {
                category: 'Comiss√µes Permanentes: O Trabalho T√©cnico de Assessoria',
                items: [
                    '<strong>COAD (Administrativa - Art. 29):</strong> Analisar presta√ß√µes de contas; emitir parecer sobre o Plano de Sa√∫de e o Relat√≥rio de Gest√£o (RAG); apurar den√∫ncias e irregularidades administrativas.',
                    '<strong>COT (T√©cnica - Art. 31):</strong> Apurar "in loco" den√∫ncias de falhas t√©cnicas e operacionais nos servi√ßos; realizar visitas peri√≥dicas √† rede de sa√∫de do SUS no munic√≠pio.',
                    '<strong>COFIN (Or√ßamento e Finan√ßas - Art. 33):</strong> Acompanhar processos de licita√ß√£o da sa√∫de; fiscalizar a execu√ß√£o or√ßament√°ria e financeira da Secretaria de Sa√∫de; subsidiar o Plen√°rio em discuss√µes sobre o financiamento do SUS.',
                    '<strong>Comunica√ß√£o e Educa√ß√£o Permanente (Art. 35):</strong> Tra√ßar a pol√≠tica de comunica√ß√£o do conselho; promover a capacita√ß√£o dos conselheiros; divulgar as a√ß√µes e delibera√ß√µes para a sociedade.',
                ],
            },
        ],
    },
    {
        id: 'reunioes',
        title: 'Funcionamento das Reuni√µes (Art. 17, 42 e 43)',
        content: '<strong>Regras centrais para o funcionamento do Plen√°rio:</strong>',
        categorizedDetails: [
            {
                category: 'Frequ√™ncia e Qu√≥rum',
                items: [
                   '<strong>Frequ√™ncia:</strong> Reuni√µes ordin√°rias mensais e extraordin√°rias quando necess√°rio.',
                   '<strong>Qu√≥rum de In√≠cio:</strong> Maioria simples dos membros (com 30 min de toler√¢ncia).',
                   '<strong>Qu√≥rum de Delibera√ß√£o:</strong> Voto de 50% + 1 de TODOS os membros (maioria absoluta).',
                ]
            },
            {
                category: 'Pauta e Convoca√ß√£o',
                items: [
                    '<strong>Convoca√ß√£o:</strong> Pauta enviada com 72h de anteced√™ncia (ordin√°rias) ou 24h (extraordin√°rias).',
                    '<strong>Estrutura da Pauta:</strong> 1) Ata, 2) Expediente (informes), 3) Ordem do Dia (delibera√ß√µes).',
                    '<strong>Publicidade:</strong> As reuni√µes s√£o p√∫blicas e abertas a qualquer interessado.',
                ]
            },
             {
                category: 'Vota√ß√£o e Delibera√ß√µes',
                items: [
                    '<strong>Vota√ß√£o:</strong> Sempre aberta, por contagem de votos (a favor, contra, absten√ß√£o). Vota√ß√£o secreta √© vedada.',
                    '<strong>Tempo de Fala:</strong> Conselheiros t√™m tempo regimental para interven√ß√µes (geralmente 3 minutos).',
                    '<strong>Delibera√ß√µes:</strong> Formalizadas atrav√©s de Resolu√ß√µes, que devem ser homologadas pelo Prefeito ou Secret√°rio de Sa√∫de.',
                ]
            }
        ]
    },
    {
        id: 'cap7',
        title: 'Cap√≠tulo VII - Disposi√ß√µes Finais',
        content: '<strong>Art. 49 a 53</strong> ‚Äì Regras finais de funcionamento:',
        details: [
            'Qualquer altera√ß√£o neste Regimento exige proposta de 1/3 dos membros.',
            'A aprova√ß√£o de mudan√ßas requer um qu√≥rum qualificado de 2/3 dos conselheiros em reuni√£o extraordin√°ria.',
            'Servidores p√∫blicos que atuam no CMSP t√™m seus sal√°rios e vantagens garantidos por lei (Art. 51).',
            'Os casos n√£o previstos no regimento (omissos) ser√£o resolvidos pelo Plen√°rio.',
        ],
    },
];

// --- COMPONENTE REUTILIZ√ÅVEL PARA ITENS DE ACORDE√ÉO ---
const AccordionItem: FC<{ title: string; children: ReactNode; icon?: ReactNode; isSubItem?: boolean; initiallyOpen?: boolean }> = 
({ title, children, icon, isSubItem = false, initiallyOpen = false }) => {
  const [isOpen, setIsOpen] = useState(initiallyOpen);

  return (
    <div className={isSubItem ? 'mt-2' : 'border-b border-gray-200 last:border-b-0'}>
      <button
        onClick={() => setIsOpen(!isOpen)}
        className={`w-full flex justify-between items-center text-left transition-colors duration-300 ${
          isSubItem 
            ? 'p-3 bg-blue-50 hover:bg-blue-100 rounded-md' 
            : 'p-4 bg-slate-100 hover:bg-slate-200'
        }`}
      >
        <div className="flex items-center">
          {icon && <span className="mr-3">{icon}</span>}
          <h3 className={isSubItem ? 'font-medium text-blue-800' : 'text-lg font-semibold text-slate-800'}>
            {title}
          </h3>
        </div>
        <motion.div
          animate={{ rotate: isOpen ? 180 : 0 }}
          transition={{ duration: 0.3 }}
        >
          <ChevronDown className={`w-5 h-5 ${isSubItem ? 'text-blue-600' : 'text-slate-600'}`} />
        </motion.div>
      </button>
      <AnimatePresence>
        {isOpen && (
          <motion.div
            initial={{ opacity: 0, height: 0 }}
            animate={{ opacity: 1, height: 'auto' }}
            exit={{ opacity: 0, height: 0 }}
            transition={{ duration: 0.3, ease: 'easeInOut' }}
            className="overflow-hidden"
          >
            <div className={isSubItem ? 'p-3 pl-5 border-l-2 border-blue-200 ml-3' : 'p-5 bg-white'}>
              {children}
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
};


// --- COMPONENTE PRINCIPAL DA APLICA√á√ÉO ---
export default function App() {
  return (
    <div className="bg-gray-50 min-h-screen p-4 sm:p-8">
      <div className="max-w-4xl mx-auto">
        <header className="text-center mb-8">
          <h1 className="text-3xl sm:text-4xl font-bold text-slate-900">
            Regimento Interno do CMSP
          </h1>
          <h2 className="text-md text-gray-500 mt-1">
            Visualiza√ß√£o Interativa do Documento Aprovado em 01/07/2021
          </h2>
        </header>

        <main className="bg-white rounded-lg shadow-md overflow-hidden">
          {regimentoData.map((item, index) => (
             <AccordionItem key={item.id} title={item.title} icon={<span>üìò</span>} initiallyOpen={index === 0}>
                <div className="text-gray-700">
                    {item.content && <p className="mb-4" dangerouslySetInnerHTML={{ __html: item.content }} />}
                    
                    {item.details && (
                        <ul className="space-y-2 list-inside">
                        {item.details.map((detail, idx) => (
                            <li key={idx} className="flex items-start">
                            <span className="text-blue-500 mr-2">‚úî</span>
                            <span dangerouslySetInnerHTML={{ __html: detail }} />
                            </li>
                        ))}
                        </ul>
                    )}

                    {item.categorizedDetails && (
                        <div className="space-y-2 mt-4">
                            {item.categorizedDetails.map((categoryItem) => (
                                <AccordionItem key={categoryItem.category} title={categoryItem.category} icon={<ChevronsRight className="w-4 h-4 text-blue-700" />} isSubItem>
                                     <ul className="space-y-2 list-inside text-sm">
                                        {categoryItem.items.map((detail, idx) => (
                                            <li key={idx} className="flex items-start">
                                            <span className="text-blue-400 mr-2">‚ñ™</span>
                                            <span dangerouslySetInnerHTML={{ __html: detail }} />
                                            </li>
                                        ))}
                                    </ul>
                                </AccordionItem>
                            ))}
                        </div>
                    )}

                    {item.subDetails && item.subDetails.map((sub, subIndex) => (
                        <div key={subIndex} className="mt-4">
                        <h4 className="font-semibold text-gray-800 mb-2">{sub.title}</h4>
                        <ul className="space-y-2 list-inside pl-4">
                            {sub.items.map((subItem, itemIndex) => (
                            <li key={itemIndex} className="flex items-start">
                                <span className="text-blue-400 mr-2">‚ñ™</span>
                                <span dangerouslySetInnerHTML={{ __html: subItem }} />
                            </li>
                            ))}
                        </ul>
                        </div>
                    ))}
                </div>
             </AccordionItem>
          ))}
        </main>
        
        <footer className="text-center mt-8 text-sm text-gray-400">
            <p>Desenvolvido com React, TypeScript e Tailwind CSS.</p>
        </footer>
      </div>
    </div>
  );
}

